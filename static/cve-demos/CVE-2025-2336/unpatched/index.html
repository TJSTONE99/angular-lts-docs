<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVE-2025-2336 - Unpatched Version</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-size: 14px;
            margin: 20px;
            background-color: #f8f9fa;
        }

        .demo-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .version-badge {
            background-color: #dc3545;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 16px;
            display: inline-block;
        }

        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 12px;
            border-radius: 4px;
            margin: 16px 0;
        }

        fieldset {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 16px;
            margin: 16px 0;
            overflow: auto;
            max-width: 100%;
        }

        legend {
            font-weight: bold;
            color: #495057;
            padding: 0 8px;
        }

        label {
            display: block;
            margin: 12px 0;
        }

        label span {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #495057;
        }

        select {
            width: 100%;
            padding: 8px 12px;
            box-sizing: border-box;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            min-width: 0;
            max-width: 100%;
        }

        pre {
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            overflow-y: auto;
            max-height: 300px;
            max-width: 100%;
            white-space: pre-wrap;
            word-break: break-word;
            margin: 16px 0;
            border: 1px solid #dee2e6;
        }

        .rendered-html {
            border: 1px solid #dee2e6;
            padding: 12px;
            border-radius: 4px;
            min-height: 60px;
            background-color: #fff;
        }

        .rendered-html svg {
            width: 32px;
            height: 32px;
            display: inline-block;
            vertical-align: middle;
        }

        .rendered-html img {
            width: 32px;
            height: 32px;
            display: inline-block;
            vertical-align: middle;
        }

        .version-stamp {
            background-color: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #495057;
            float: right;
        }

        h3 {
            margin-top: 0;
            color: #495057;
        }

        hr {
            margin: 20px 0;
            border: none;
            border-top: 1px solid #dee2e6;
        }
    </style>
</head>

<body>
    <div class="demo-container" ng-app="vulnerableApp" ng-controller="VulnerableCtrl as $ctrl">
        <div class="version-badge">UNPATCHED - Vulnerable Version</div>

        <h3>CVE-2025-2336 - ngSanitize SVG Image Sanitization Bypass (Vulnerable)</h3>

        <div class="warning">
            <strong>⚠️ WARNING:</strong> This version allows SVG &lt;image&gt; elements to bypass image source
            sanitization in the $sanitize service.
        </div>

        <span class="version-stamp">AngularJS v{{ $ctrl.version }}</span>

        <p>
            This app uses the <code>ngSanitize</code> module and is configured to only allow images from
            <code>https://angularjs.org/</code>:
        </p>
        <pre><code>$compileProvider.imgSrcSanitizationTrustedUrlList(/^https:\/\/angularjs\.org\//);</code></pre>

        <p>
            However, SVG <code>&lt;image&gt;</code> elements are not correctly detected as images by the
            <code>$sanitize</code> service,
            allowing them to bypass image source restrictions when used with <code>ng-bind-html</code>.
        </p>

        <fieldset>
            <legend>Input</legend>

            <p>
                <label>
                    <span>Choose image URL type:</span>
                    <select ng-model="$ctrl.imageUrl" ng-options="item as item.label for item in $ctrl.imageUrls"
                        ng-change="$ctrl.updateHtmlPayload()">
                    </select>
                </label>
            </p>

            <p>
                <label>
                    <span>Choose HTML payload type:</span>
                    <select ng-model="$ctrl.htmlTemplate"
                        ng-options="item as item.label for item in $ctrl.htmlTemplates"
                        ng-change="$ctrl.updateHtmlPayload()">
                    </select>
                </label>
            </p>

            <hr />

            <p><strong>Computed HTML payload:</strong></p>
            <pre ng-bind="$ctrl.htmlPayload"></pre>
        </fieldset>

        <fieldset>
            <legend>Output</legend>

            <p><strong>Sanitized HTML:</strong></p>
            <pre ng-bind="$ctrl.sanitizedHtml"></pre>

            <hr />

            <p><strong>Rendered HTML:</strong></p>
            <div class="rendered-html" ng-bind-html="$ctrl.htmlPayload"></div>
        </fieldset>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/TJSTONE99/bower-angular-lts@v1.8.4/angular.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/gh/TJSTONE99/bower-angular-sanitize-lts@v1.8.4/angular-sanitize.min.js"></script>

    <script>
        // Vulnerable version - CVE-2025-2336 demonstration
        angular.module('vulnerableApp', ['ngSanitize'])
            .config(function ($compileProvider, $sanitizeProvider) {
                // Configure image source sanitization to only allow angularjs.org
                $compileProvider.imgSrcSanitizationTrustedUrlList(/^https:\/\/angularjs\.org\//);
                $sanitizeProvider.enableSvg(true);
            })
            .controller('VulnerableCtrl', function ($sanitize) {
                var vm = this;

                vm.version = angular.version.full;

                vm.imageUrls = [
                    {
                        label: 'URL from allowed domain (https://angularjs.org/)',
                        value: 'https://angularjs.org/favicon.ico'
                    },
                    {
                        label: 'URL from disallowed domain (https://angular.dev/) - should be blocked',
                        value: 'https://angular.dev/favicon.ico'
                    }
                ];

                vm.htmlTemplates = [
                    {
                        label: '[SAFE] Regular <img> element',
                        value: '<img src="{{URL}}" alt="Regular image" width="32" height="32">'
                    },
                    {
                        label: '[UNSAFE] SVG <image> with href attribute - bypasses sanitization',
                        value: '<svg width="32" height="32"><image href="{{URL}}" width="32" height="32"></image></svg>'
                    },
                    {
                        label: '[UNSAFE] SVG <image> with xlink:href attribute - bypasses sanitization',
                        value: '<svg width="32" height="32"><image xlink:href="{{URL}}" width="32" height="32"></image></svg>'
                    }
                ];

                // Initialize with first options
                vm.imageUrl = vm.imageUrls[1]; // Start with disallowed domain to show the vulnerability
                vm.htmlTemplate = vm.htmlTemplates[0]; // Start with safe template

                vm.updateHtmlPayload = function () {
                    vm.htmlPayload = vm.htmlTemplate.value.replace('{{URL}}', vm.imageUrl.value);
                    vm.sanitizedHtml = $sanitize(vm.htmlPayload);
                };

                // Initialize
                vm.updateHtmlPayload();
            });
    </script>
</body>

</html>